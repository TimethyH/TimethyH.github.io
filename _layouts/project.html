---
layout: default
---

<!-- MUST run before any video content is parsed by the browser -->
<script type="text/javascript">
  (function() {
    var isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
    var isMobile = window.innerWidth <= 768;

    function stripVideo(video) {
      var src = video.getAttribute('src');
      if (src) {
        video.setAttribute('data-src', src);
        video.removeAttribute('src');
      }
      var sources = video.querySelectorAll('source');
      for (var i = 0; i < sources.length; i++) {
        var s = sources[i].getAttribute('src');
        if (s) {
          sources[i].setAttribute('data-src', s);
          sources[i].removeAttribute('src');
        }
      }
      // Store original attributes before removing
      if (video.hasAttribute('autoplay')) {
        video.setAttribute('data-autoplay', 'true');
        video.removeAttribute('autoplay');
      }
      if (video.hasAttribute('loop')) {
        video.setAttribute('data-loop', 'true');
        // Keep loop on desktop, remove on iOS
        if (isIOS || isMobile) video.removeAttribute('loop');
      }
      video.setAttribute('preload', 'none');
    }

    // Catch videos as soon as they appear in the DOM
    var observer = new MutationObserver(function(mutations) {
      for (var i = 0; i < mutations.length; i++) {
        var nodes = mutations[i].addedNodes;
        for (var j = 0; j < nodes.length; j++) {
          if (nodes[j].nodeName === 'VIDEO') stripVideo(nodes[j]);
          if (nodes[j].querySelectorAll) {
            var videos = nodes[j].querySelectorAll('video');
            for (var k = 0; k < videos.length; k++) stripVideo(videos[k]);
          }
        }
      }
    });
    observer.observe(document.documentElement, { childList: true, subtree: true });
  })();
</script>

{% if page.thumbnail %}
<!-- Background image with fade effect -->
<div class="project-background" style="--project-bg-image: url('{{ page.thumbnail | relative_url }}');"></div>
{% endif %}

<div class="project-container {% if page.thumbnail %}with-background{% endif %}">
  <a href="{{ '/projects/' | relative_url }}" class="project-back-button">
    ‚Üê Back to Projects
  </a>

  <div class="project-header">
    <h1>{{ page.title }}</h1>
    {% if page.subtitle %}
    <h4 class="project-subtitle">{{ page.subtitle }}</h4>
    {% endif %}

   {% if page.tags %}
    <div class="project-tags">
      {% for tag in page.tags %}
      <span class="project-tag">{{ tag }}</span>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <article itemscope itemtype="http://schema.org/BlogPosting">
    <div itemprop="articleBody">
      {{ content }}
    </div>
  </article>

  <div class="project-share">
    {%- include share_page.html -%}
  </div>

  <div class="project-comments">
    {%- include blog_post_comments.html -%}
  </div>

  <!-- Project footer signature -->
  <div class="project-footer">
    <div class="project-footer-divider"></div>
    <div class="project-footer-content">
      <a href="{{ '/' | relative_url }}" class="project-footer-signature">
        <div class="signature-name">Timethy Hyman</div>
        <div class="signature-title">Graphics Programmer</div>
      </a>
      <div class="project-footer-social">
        <a href="{{ site.github_username | prepend: 'https://github.com/' }}" target="_blank" rel="noopener" aria-label="GitHub">
          <i class="fab fa-github"></i>
        </a>
        <a href="{{ site.linkedin_username | prepend: 'https://linkedin.com/in/' }}" target="_blank" rel="noopener" aria-label="LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </div>
    </div>
  </div>

  <!-- Initialize lightGallery for project images -->
  <script type="text/javascript">
    $(document).ready(function() {
      $(".project-media").lightGallery({
        thumbnail: false,
        selector: '.image'
      });
    });
  </script>

  <!-- Lazy load all videos, autoplay+loop on desktop, manual on mobile/iOS -->
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
      var isMobile = window.innerWidth <= 768;
      var isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      var isDesktop = !isMobile && !isIOS;

      var videoObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          var video = entry.target;

          if (entry.isIntersecting) {
            // Load video source if stripped
            var dataSrc = video.getAttribute('data-src');
            if (dataSrc && !video.getAttribute('src')) {
              video.setAttribute('src', dataSrc);
              video.load();
            }
            var sources = video.querySelectorAll('source');
            for (var i = 0; i < sources.length; i++) {
              var ds = sources[i].getAttribute('data-src');
              if (ds && !sources[i].getAttribute('src')) {
                sources[i].setAttribute('src', ds);
              }
            }

            // Desktop: restore autoplay + loop
            if (isDesktop && video.getAttribute('data-autoplay') === 'true') {
              if (video.getAttribute('data-loop') === 'true') {
                video.setAttribute('loop', '');
              }
              video.play().catch(function(err) {
                console.log('Autoplay prevented:', err);
              });
            }
          } else {
            // Pause when out of view
            video.pause();

            // Unload to free memory (desktop keeps src cached by browser, 
            // but releasing the element helps with decode overhead)
            var src = video.getAttribute('src');
            if (src) {
              video.setAttribute('data-src', src);
              video.removeAttribute('src');
              video.load(); // resets decoder, frees GPU memory
            }
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '300px' // desktop: preload a bit earlier for smoother experience
      });

      document.querySelectorAll('video').forEach(function(video) {
        videoObserver.observe(video);
      });
    });
  </script>
</div>